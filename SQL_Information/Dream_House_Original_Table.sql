
-------- Updated Table ------------------------

CREATE TABLE DH_Branch (
    branchNo VARCHAR2(10) PRIMARY KEY,
    street VARCHAR2(50) NOT NULL,
    cityID NUMBER NOT NULL,
    postcode VARCHAR2(10) NOT NULL,
    CONSTRAINT fk_branch_city FOREIGN KEY (cityID) REFERENCES DH_City(cityID)
);

CREATE INDEX idx_branch_city ON DH_Branch(cityID);
COMMIT;

-------- Updated Table ------------------------

CREATE TABLE DH_Staff (
    staffNo VARCHAR2(10) PRIMARY KEY,
    fname VARCHAR2(50) NOT NULL,
    lname VARCHAR2(50) NOT NULL,
    position VARCHAR2(50) NOT NULL,
    sex CHAR(1) NOT NULL CHECK (sex IN ('M', 'F', 'O')),
    dob DATE NOT NULL CHECK (dob <= SYSDATE),
    salary NUMBER(9,2) DEFAULT 0 CHECK (salary >= 0),
    branchNo VARCHAR2(10) NOT NULL,
    telephone VARCHAR2(20),
    mobile VARCHAR2(20),
    email VARCHAR2(100) UNIQUE NOT NULL,
    CONSTRAINT fk_staff_branch FOREIGN KEY (branchNo) REFERENCES DH_Branch(branchNo)
);

CREATE INDEX idx_staff_branch ON DH_Staff(branchNo);

COMMIT;


-------- Updated Table ------------------------
CREATE TABLE DH_PrivateOwner (
    ownerNo CHAR(5) PRIMARY KEY,
    fname VARCHAR2(50) NOT NULL,
    lname VARCHAR2(50) NOT NULL,
    street VARCHAR2(100) NOT NULL,
    cityID NUMBER NOT NULL,
    postcode VARCHAR2(10),
    telNo VARCHAR2(20),
    email VARCHAR2(100) UNIQUE,
    password VARCHAR2(100) NOT NULL, -- hashed password
    CONSTRAINT fk_owner_city FOREIGN KEY (cityID) REFERENCES DH_City(cityID),
    CONSTRAINT chk_owner_email_format CHECK (email IS NULL OR REGEXP_LIKE(email, '^[^@]+@[^@]+\.[^@]+$'))
);

CREATE INDEX idx_owner_city ON DH_PrivateOwner(cityID);

COMMIT;

-------- Updated Table ------------------------
CREATE TABLE DH_PropertyForRent (
    propertyNo VARCHAR2(10) PRIMARY KEY,
    street VARCHAR2(100) NOT NULL,
    cityID NUMBER NOT NULL,
    postcode VARCHAR2(10) NOT NULL,
    typeID NUMBER NOT NULL,
    rooms NUMBER(2) CHECK (rooms > 0),
    rent NUMBER(9,2) CHECK (rent >= 0),
    ownerNo CHAR(5) NOT NULL,
    staffNo VARCHAR2(10) NOT NULL,
    branchNo VARCHAR2(10) NOT NULL,
    picture VARCHAR2(255) DEFAULT 'images/default_property.jpg',
    floorPlan VARCHAR2(255),
    statusID NUMBER DEFAULT 1 NOT NULL, -- Default to 'Available'
    CONSTRAINT fk_property_city FOREIGN KEY (cityID) REFERENCES DH_City(cityID),
    CONSTRAINT fk_property_type FOREIGN KEY (typeID) REFERENCES DH_PropertyType(typeID),
    CONSTRAINT fk_property_owner FOREIGN KEY (ownerNo) REFERENCES DH_PrivateOwner(ownerNo),
    CONSTRAINT fk_property_staff FOREIGN KEY (staffNo) REFERENCES DH_Staff(staffNo),
    CONSTRAINT fk_property_branch FOREIGN KEY (branchNo) REFERENCES DH_Branch(branchNo),
    CONSTRAINT fk_property_status FOREIGN KEY (statusID) REFERENCES DH_PropertyStatus(statusID)
);

CREATE INDEX idx_property_city ON DH_PropertyForRent(cityID);
CREATE INDEX idx_property_type ON DH_PropertyForRent(typeID);
CREATE INDEX idx_property_status ON DH_PropertyForRent(statusID);


COMMIT;


-------- Updated Table ------------------------
CREATE TABLE DH_Client (
    clientNo VARCHAR2(10) PRIMARY KEY,
    fname VARCHAR2(50) NOT NULL,
    lname VARCHAR2(50) NOT NULL,
    telNo VARCHAR2(20),
    street VARCHAR2(100),
    cityID NUMBER,
    postcode VARCHAR2(10),
    email VARCHAR2(100) UNIQUE NOT NULL,
    prefTypeID NUMBER, -- FK to DH_PropertyType
    maxRent NUMBER(9,2) DEFAULT 0 CHECK (maxRent >= 0),
    CONSTRAINT fk_client_city FOREIGN KEY (cityID) REFERENCES DH_City(cityID),
    CONSTRAINT fk_client_prefType FOREIGN KEY (prefTypeID) REFERENCES DH_PropertyType(typeID),
    CONSTRAINT chk_client_email_format CHECK (email LIKE '%_@__%.__%')
);

CREATE INDEX idx_client_city ON DH_Client(cityID);
CREATE INDEX idx_client_prefType ON DH_Client(prefTypeID);

COMMIT;

-------- Updated Table ------------------------
CREATE TABLE DH_Viewing (
    viewingID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    clientNo VARCHAR2(10) NOT NULL,
    propertyNo VARCHAR2(10) NOT NULL,
    viewDate DATE NOT NULL,
    comments VARCHAR2(500) DEFAULT NULL,
    CONSTRAINT fk_viewing_client FOREIGN KEY (clientNo) REFERENCES DH_Client(clientNo),
    CONSTRAINT fk_viewing_property FOREIGN KEY (propertyNo) REFERENCES DH_PropertyForRent(propertyNo)
);

CREATE INDEX idx_viewing_client ON DH_Viewing(clientNo);
CREATE INDEX idx_viewing_property ON DH_Viewing(propertyNo);

COMMIT;

-------- Updated Table ------------------------
CREATE TABLE DH_Registration (
    clientNo VARCHAR2(10) NOT NULL,
    branchNo VARCHAR2(10) NOT NULL,
    staffNo VARCHAR2(10) NOT NULL,
    dateRegister DATE DEFAULT SYSDATE NOT NULL,
    PRIMARY KEY (clientNo, branchNo),
    CONSTRAINT fk_registration_client FOREIGN KEY (clientNo) REFERENCES DH_Client(clientNo),
    CONSTRAINT fk_registration_branch FOREIGN KEY (branchNo) REFERENCES DH_Branch(branchNo),
    CONSTRAINT fk_registration_staff FOREIGN KEY (staffNo) REFERENCES DH_Staff(staffNo)
);

CREATE INDEX idx_registration_staff ON DH_Registration(staffNo);

COMMIT;

-------- Updated Table ------------------------

CREATE TABLE DH_Lease (
    leaseNo NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    clientNo VARCHAR2(10) NOT NULL,
    propertyNo VARCHAR2(10) NOT NULL,
    leaseAmount NUMBER(9,2) DEFAULT 0 CHECK (leaseAmount >= 0),
    leaseStart DATE NOT NULL,
    leaseEnd DATE NOT NULL,
    CONSTRAINT fk_lease_client FOREIGN KEY (clientNo) REFERENCES DH_Client(clientNo),
    CONSTRAINT fk_lease_property FOREIGN KEY (propertyNo) REFERENCES DH_PropertyForRent(propertyNo),
    CONSTRAINT chk_lease_dates CHECK (leaseEnd > leaseStart)
);

CREATE INDEX idx_lease_client ON DH_Lease(clientNo);
CREATE INDEX idx_lease_property ON DH_Lease(propertyNo);

COMMIT;
 
 
 ----------- Data ----------------------------------
 
insert into DH_Branch values ('B002','56 Cover Drive','London','NW10 6EU');
insert into DH_Branch values ('B003','163 Main Street','Glasgow','G11 9QX');
insert into DH_Branch values ('B004','32 Manse Road','Bristol','BS99 1NZ');
insert into DH_Branch values ('B005','22 Deer Road','London','SW1 4EH');
insert into DH_Branch values ('B007','16 Argyll Street','Aberdeen','AB2 3SU');


insert into DH_Staff values ('SA9','Mary','Howe','Assistant','F',to_date('1970-02-19','yyyy-mm-dd'),9000,'B007','1338','079555 12345','MaryHowe@Dreamhome.co.uk');
insert into DH_Staff values ('SG14','David','Ford','Supervisor','M',to_date('1958-03-24','yyyy-mm-dd'),18000,'B003','0223','079555 12344','DavidFord@Dreamhome.co.uk');
insert into DH_Staff values ('SG37','Ann','Beech','Assistant','F',to_date('1960-11-10','yyyy-mm-dd'),12000,'B003','0224','079555 12346','AnnBeech@Dreamhome.co.uk');
insert into DH_Staff values ('SG5','Susan','Brand','Manager','F',to_date('1940-6-3','yyyy-mm-dd'),24000,'B003','0225','079555 12347','SusanBrand@Dreamhome.co.uk');
insert into DH_Staff values ('SL21','John','White','Manager','M',to_date('1945-10-1','yyyy-mm-dd'),30000,'B005','1512','090555 12345','JohnWhite@Dreamhome.co.uk');
insert into DH_Staff values ('SL41','Julie','Lee','Assistant','F',to_date('1965-6-13','yyyy-mm-dd'),9000,'B005','1514','090555 12346','JulieLee@Dreamhome.co.uk');



insert into DH_PrivateOwner values ('CO46','Jonathan','Donaway', 'Abbey street','99095559','jd@gmail.com', '1111' );
insert into DH_PrivateOwner values ('CO93','Janet','Duncan', 'Abbey street','99095559','jd@gmail.com', '1111' );

insert into DH_PrivateOwner values ('CO87','Bobby','Gilles', '35 Abbey street','97095559','bg@gmail.com', '1111' );
insert into DH_PrivateOwner values ('CO40','Gillan','Moneskun', '44 Balder street','99095559','gm@gmail.com', '1111' );
insert into DH_PrivateOwner values ('CO66','Samantha','Kirk', '34 King street','99095559','sk@gmail.com', '1111' );
insert into DH_PrivateOwner values ('CO73','Bruce','Willes', '56 Bogdan street','99095559','bw@gmail.com', '1111' );
insert into DH_PrivateOwner values ('CO77','Giselle','Bunchen', '45 Queen Abbey street','99095559','jd@gmail.com', '1111' );


insert into DH_PropertyForRent values ('PA14','16 Holhead','Aberdeen','AB7 5SU','House',6,650,'CO46','SA9','B007','images/house2.jpg','images/plan1.jpg');
insert into DH_PropertyForRent values ('PG16','5 Novar Drive','Glasgow','G12 9AX','Flat',4,450,'CO93','SG14','B003','images/house3.jpg','images/plan1.jpg');
insert into DH_PropertyForRent values ('PG21','18 Dale Road','Glasgow','G12','House',5,600,'CO87','SG37','B003','images/house4.jpg','images/plan1.jpg');
insert into DH_PropertyForRent values ('PG36','2 Manor Road','Glasgow','G32 4QX','Flat',3,375,'CO93','SG37','B003','images/house5.jpg','images/plan1.jpg');
insert into DH_PropertyForRent values ('PG4','6 Lawrence Street','Glasgow','G11 9QX','Flat',3,350,'CO40','SA9','B003','images/house2.jpg','images/plan1.jpg');
insert into DH_PropertyForRent values ('PG97','Muir Drive','Aberdeen','AB42 1DD','House',3,380,'CO46','SA9','B007','images/house1.jpg','images/plan1.jpg');
insert into DH_PropertyForRent values ('PL94','6 Argyll Street','London','NW2','Flat',4,400,'CO87','SL41','B005','images/house3.jpg','images/plan1.jpg');


insert into DH_Client values ('CR56','Fred','Flintstone','555 1234','12 Rock Way','Bedrock','fred@flintyrock.com','House',450);
insert into DH_Client values ('CR62','Wilma','Flintstone','555 1234','12 Rock Way','Bedrock','wilma@flintyrock.com','Flat',350);
insert into DH_Client values ('CR74','Albert','Johnstone','555 6677','1 Way St.','Chicago','albie@johnstone.com','Flat',450);
insert into DH_Client values ('CR77','Clark','Kent','555 9999','1 Super Way','Smallville','clark@supersite.com','Flat',400);
insert into DH_Client values ('CR79','Joe','Bloggs','123 4567','5 High St','Paisley','joe@paisley.com','House',450);
insert into DH_Client values ('CR83','Edward','Scissorhands','123 4567','1 Snip St.','Scissorland','eddie@scix.com','House',300);
insert into DH_Client values ('CR45','Albert','Enistein','555 6789','12 Long Island Way','New Jersey','bert@nuclearintent.com','Flat',450);
insert into DH_Client values ('CR90','Snorrie','Sturrluson','333 4567','1 Vik Way','Rekjavik','snorrie@iceland.com','Flat',400);

insert into DH_Client values ('CR34','Ferdinand','Oblogiotta','123 5555','12 Strumpetwise Street','Lagrange Orage', 'ferdy@orage.com','House',450);
insert into DH_Client values ('CR64','Joe','Schmoe','123 45678','1 High St','Largs','joes@largy.com','House',550);
insert into DH_Client values ('CR92','Bill','Gates','123 5555','1 Rich Street','Seattle','bill@gatesland.com','House',1000);
insert into DH_Client values ('CR55','Bruce','Wayne','555 6789','1 Wayne Manor','Gotham','wayne@batty.com','House',900);





insert into DH_viewing values ('CR62','PA14',to_date('2004-7-1','yyyy-mm-dd'),null);
insert into DH_viewing values('CR74','PG36',to_date('2004-7-1','yyyy-mm-dd'), null);
insert into DH_viewing values('CR74','PG4',to_date('2004-7-1','yyyy-mm-dd'),'Tidy but too small');
insert into DH_viewing values ('CR83','PA14',to_date('2004-7-2','yyyy-mm-dd'),null);
insert into DH_viewing values('CR83','PG4',to_date('2004-7-2','yyyy-mm-dd'),null);
insert into DH_viewing values ('CR55','PA14',to_date('2004-6-20','yyyy-mm-dd'),'size ok but location is not good');
insert into DH_viewing values('CR55','PG21',to_date('2004-6-21','yyyy-mm-dd'),null);
insert into DH_viewing values('CR64','PA14',to_date('2004-6-20','yyyy-mm-dd'),null);
insert into DH_viewing values('CR64','PG21',to_date('2004-11-22','yyyy-mm-dd'),'Not that bad ');
insert into DH_viewing values('CR64','PG36',to_date('2004-11-23','yyyy-mm-dd'),'Kitchen is too small.');
insert into DH_viewing values('CR34','PG16',to_date('2004-11-23','yyyy-mm-dd'),null);
insert into DH_viewing values('CR90','PG21',to_date('2004-11-25','yyyy-mm-dd'),null);
INSERT INTO DH_VIEWING VALUES ('CR90', 'PG4',SYSDATE,'rooms are too small');


 


INSERT INTO DH_REGISTRATION  values ('CR62','B002', 'SA9',to_date('2004-11-22','yyyy-mm-dd') );
INSERT INTO DH_REGISTRATION  values ('CR55','B003', 'SL21',to_date('2006-11-22','yyyy-mm-dd') );
INSERT INTO DH_REGISTRATION  values ('CR62','B004', 'SG37',to_date('2005-11-22','yyyy-mm-dd') );
INSERT INTO DH_REGISTRATION  values ('CR90','B004', 'SL21',to_date('2005-12-22','yyyy-mm-dd') );


 INSERT INTO DH_LEASE values ( 1,'CR55','PG16',550,to_date('2005-12-22','yyyy-mm-dd'), to_date('2007-12-22','yyyy-mm-dd') );
 INSERT INTO DH_LEASE values ( 2,'CR62','PG21',580,to_date('2006-11-22','yyyy-mm-dd'), to_date('2007-10-22','yyyy-mm-dd') );
 INSERT INTO DH_LEASE values ( 3,'CR90','PG36',620,to_date('2003-10-22','yyyy-mm-dd'), to_date('2007-11-22','yyyy-mm-dd') );
 INSERT INTO DH_LEASE values ( 4,'CR64','PG36',800,to_date('2002-12-22','yyyy-mm-dd'), to_date('2005-09-22','yyyy-mm-dd') );
 INSERT INTO DH_LEASE values ( 5,'CR83','PL94',7500,to_date('2008-08-22','yyyy-mm-dd'), to_date('2009-12-22','yyyy-mm-dd') );
 
 